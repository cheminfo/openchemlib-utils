!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).OCLUtils={})}(this,(function(t){"use strict";let e;function o(){if(!e)throw new Error("OCL has to be initialized using initOCL(OCL)");return e}let r=0;function s(t,e){let s=`${t.getAtomLabel(e)}*`;return t.setAtomCustomLabel(e,s),1===t.getAtomicNo(e)?t.setAtomicNo(e,function(){if(!r){const t=o();r=t.Molecule.getAtomicNoFromLabel("X")}return r}()):t.setAtomMass(e,t.getAtomMass(e)+5),s}function n(t,e={}){const{Molecule:r}=o(),{esrType:n=r.cESRTypeAnd}=e;for(let e=0;e<t.getAllAtoms();e++){let o=t.getCompactCopy();s(o,e),o.ensureHelperArrays(r.cHelperBitsStereo);for(let e=0;e<o.getAtoms();e++)if(o.isAtomStereoCenter(e)&&-1===o.getStereoBond(e)){let s=o.getAtomPreferredStereoBond(e);if(-1!==s){if(t.setBondType(s,r.cBondTypeUp),t.getBondAtom(1,s)===e){let o=t.getBondAtom(0,s);t.setBondAtom(0,s,e),t.setBondAtom(1,s,o)}t.setAtomESR(e,n,0)}}}}function i(t){const{Molecule:e}=o();t.ensureHelperArrays(e.cHelperCIP);for(let o=0;o<t.getAllAtoms();o++)t.getAtomParity(o)!==e.cAtomParityNone&&t.setAtomESR(o,e.cESRTypeAnd,0)}function l(t){const e=o();n(t);let r=t.getAllAtoms(),l=[];for(let o=0;o<r;o++){let r=t.getCompactCopy();s(r,o),i(r),l[o]=r.getCanonizedIDCode(e.Molecule.CANONIZER_ENCODE_ATOM_CUSTOM_LABELS)}return l}function h(t){const e=o(),r=t.getCompactCopy();r.addImplicitHydrogens(),r.ensureHelperArrays(e.Molecule.cHelperNeighbours);const s=l(r),n=[];for(let t=0;t<s.length;t++){const e={oclID:s[t],hydrogenOCLIDs:[],nbHydrogens:0};for(let o=0;o<r.getAllConnAtoms(t);o++){const n=r.getConnAtom(t,o);1===r.getAtomicNo(n)&&(e.nbHydrogens++,-1===e.hydrogenOCLIDs.indexOf(s[n])&&e.hydrogenOCLIDs.push(s[n]))}n.push(e)}return n}function u(t,e){return 6===t.getAtomicNo(e)&&(0===t.getAtomCharge(e)&&t.getImplicitHydrogens(e)+t.getConnAtoms(e)===4)}const c=1;function a(t,e,r={}){const n=o(),{minSphereSize:l=0,maxSphereSize:h=4,kind:a=c,isTagged:f=!1}=r,m=t.getCompactCopy();if(!f){let t=s(m,e);m.addImplicitHydrogens(),m.addMissingChirality(),m.ensureHelperArrays(n.Molecule.cHelperNeighbours);for(let o=0;o<m.getAllAtoms();o++)if(t===m.getAtomCustomLabel(o)){e=o;break}}let g=new n.Molecule(0,0),w=[],p=0,d=0,y=new Array(m.getAllAtoms()),b=new Array(m.getAllAtoms());for(let t=0;t<=h;t++){if(0===d)b[0]=e,y[e]=!0,d=1;else{let t=d;for(let e=p;e<d;e++){let o=b[e];for(let e=0;e<m.getAllConnAtoms(o);e++){let r=m.getConnAtom(o,e);if(!y[r])switch(a){case c:y[r]=!0,b[t++]=r;break;case 2:u(m,o)&&u(m,r)||(y[r]=!0,b[t++]=r);break;default:throw new Error("getHoseCoesForAtom unknown kind")}}}p=d,d=t}m.copyMoleculeByAtoms(g,y,!0,null),t>=l&&(i(g),w.push(g.getCanonizedIDCode(n.Molecule.CANONIZER_ENCODE_ATOM_CUSTOM_LABELS)))}return w}function f(t,e={}){const r=o().Molecule.fromIDCode(t);r.addImplicitHydrogens(),r.addMissingChirality();let s=-1;for(let t=0;t<r.getAllAtoms();t++){const e=r.getAtomCustomLabel(t);if(null!=e&&e.endsWith("*")){s=t;break}}if(s>=0)return e.isTagged=!0,a(r,s,e)}function m(t){const e=o();t.ensureHelperArrays(e.Molecule.cHelperRings);let r=l(t),s=[];for(let e=0;e<r.length;e++){let o={oclID:r[e],extra:{singleBonds:0,doubleBonds:0,tripleBonds:0,aromaticBonds:0,cnoHybridation:0}},n=o.extra;s.push(o),o.abnormalValence=t.getAtomAbnormalValence(e),o.charge=t.getAtomCharge(e),o.cipParity=t.getAtomCIPParity(e),o.color=t.getAtomColor(e),o.customLabel=t.getAtomCustomLabel(e),o.atomicNo=t.getAtomicNo(e),o.label=t.getAtomLabel(e),o.mass=t.getAtomMass(e),o.radical=t.getAtomRadical(e),o.ringBondCount=t.getAtomRingBondCount(e),o.ringSize=t.getAtomRingSize(e),o.x=t.getAtomX(e),o.y=t.getAtomY(e),o.z=t.getAtomZ(e),o.allHydrogens=t.getAllHydrogens(e),o.connAtoms=t.getConnAtoms(e),o.allConnAtoms=t.getAllConnAtoms(e),o.implicitHydrogens=o.allHydrogens+o.connAtoms-o.allConnAtoms,o.isAromatic=t.isAromaticAtom(e),o.isAllylic=t.isAllylicAtom(e),o.isStereoCenter=t.isAtomStereoCenter(e),o.isRing=t.isRingAtom(e),o.isSmallRing=t.isSmallRingAtom(e),o.isStabilized=t.isStabilizedAtom(e),o.extra.singleBonds=1===o.atomicNo?0:o.implicitHydrogens;for(let o=0;o<t.getAllConnAtoms(e);o++){let r=t.getConnBond(e,o),s=t.getBondOrder(r);t.isAromaticBond(r)?n.aromaticBonds++:1===s?n.singleBonds++:2===s?n.doubleBonds++:3===s&&n.tripleBonds++}if(o.extra.totalBonds=o.extra.singleBonds+o.extra.doubleBonds+o.extra.tripleBonds+o.extra.aromaticBonds,6===o.atomicNo)o.extra.cnoHybridation=o.extra.totalBonds-1;else if(7===o.atomicNo)o.extra.cnoHybridation=o.extra.totalBonds;else if(8===o.atomicNo)o.extra.cnoHybridation=o.extra.totalBonds+1;else if(1===o.atomicNo){let r=0===t.getAllConnAtoms(e)?0:t.getAtomicNo(t.getConnAtom(e,0));o.extra.hydrogenOnAtomicNo=r,7!==r&&8!==r||(o.extra.labileHydrogen=!0)}}return s}const g=Object.prototype.toString;var w=function(t){return g.call(t).endsWith("Array]")};function p(t){if(!w(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],o=1;o<t.length;o++)t[o]>e&&(e=t[o]);return e}function d(t){if(!w(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],o=1;o<t.length;o++)t[o]<e&&(e=t[o]);return e}function y(t){var e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!w(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==o.output){if(!w(o.output))throw new TypeError("output option must be an array if specified");e=o.output}else e=new Array(t.length);var r=d(t),s=p(t);if(r===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var n=o.min,i=void 0===n?o.autoMinMax?r:0:n,l=o.max,h=void 0===l?o.autoMinMax?s:1:l;if(i>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-i)/(s-r),c=0;c<t.length;c++)e[c]=(t[c]-r)*u+i;return e}function b(t,e,o){let r=o?t.rows:t.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function A(t,e,o){let r=o?t.columns:t.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function M(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function x(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function C(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function E(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function S(t,e,o,r,s){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(v("startRow",e),v("endRow",o),v("startColumn",r),v("endColumn",s),e>o||r>s||e<0||e>=t.rows||o<0||o>=t.rows||r<0||r>=t.columns||s<0||s>=t.columns)throw new RangeError("Submatrix indices are out of range")}function R(t,e=0){let o=[];for(let r=0;r<t;r++)o.push(e);return o}function v(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function I(t){const e=String(t);if(e.length<=8)return e.padEnd(8," ");const o=t.toPrecision(6);if(o.length<=8)return o;const r=t.toExponential(6),s=r.indexOf("e"),n=r.substring(s);return r.substring(0,8-n.length)+n}class T{static from1DArray(t,e,o){if(t*e!==o.length)throw new RangeError("data length does not match given dimensions");let r=new D(t,e);for(let s=0;s<t;s++)for(let t=0;t<e;t++)r.set(s,t,o[s*e+t]);return r}static rowVector(t){let e=new D(1,t.length);for(let o=0;o<t.length;o++)e.set(0,o,t[o]);return e}static columnVector(t){let e=new D(t.length,1);for(let o=0;o<t.length;o++)e.set(o,0,t[o]);return e}static zeros(t,e){return new D(t,e)}static ones(t,e){return new D(t,e).fill(1)}static rand(t,e,o={}){if("object"!=typeof o)throw new TypeError("options must be an object");const{random:r=Math.random}=o;let s=new D(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++)s.set(o,t,r());return s}static randInt(t,e,o={}){if("object"!=typeof o)throw new TypeError("options must be an object");const{min:r=0,max:s=1e3,random:n=Math.random}=o;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(r>=s)throw new RangeError("min must be smaller than max");let i=s-r,l=new D(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++){let e=r+Math.round(n()*i);l.set(o,t,e)}return l}static eye(t,e,o){void 0===e&&(e=t),void 0===o&&(o=1);let r=Math.min(t,e),s=this.zeros(t,e);for(let t=0;t<r;t++)s.set(t,t,o);return s}static diag(t,e,o){let r=t.length;void 0===e&&(e=r),void 0===o&&(o=e);let s=Math.min(r,e,o),n=this.zeros(e,o);for(let e=0;e<s;e++)n.set(e,e,t[e]);return n}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let o=t.rows,r=t.columns,s=new D(o,r);for(let n=0;n<o;n++)for(let o=0;o<r;o++)s.set(n,o,Math.min(t.get(n,o),e.get(n,o)));return s}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let o=t.rows,r=t.columns,s=new this(o,r);for(let n=0;n<o;n++)for(let o=0;o<r;o++)s.set(n,o,Math.max(t.get(n,o),e.get(n,o)));return s}static checkMatrix(t){return T.isMatrix(t)?t:new D(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)t.call(this,e,o);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)t.push(this.get(e,o));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let o=0;o<this.columns;o++)t[e].push(this.get(e,o))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,o=-1,r=!0,s=!1;for(;t<this.rows&&r;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>o?(s=!0,o=e):(r=!1,s=!0);t++}return r}isReducedEchelonForm(){let t=0,e=0,o=-1,r=!0,s=!1;for(;t<this.rows&&r;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>o?(s=!0,o=e):(r=!1,s=!0);for(let o=e+1;o<this.rows;o++)0!==this.get(t,o)&&(r=!1);t++}return r}echelonForm(){let t=this.clone(),e=0,o=0;for(;e<t.rows&&o<t.columns;){let r=e;for(let s=e;s<t.rows;s++)t.get(s,o)>t.get(r,o)&&(r=s);if(0===t.get(r,o))o++;else{t.swapRows(e,r);let s=t.get(e,o);for(let r=o;r<t.columns;r++)t.set(e,r,t.get(e,r)/s);for(let r=e+1;r<t.rows;r++){let s=t.get(r,o)/t.get(e,o);t.set(r,o,0);for(let n=o+1;n<t.columns;n++)t.set(r,n,t.get(r,n)-t.get(e,n)*s)}e++,o++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,o=t.rows,r=o-1;for(;r>=0;)if(0===t.maxRow(r))r--;else{let s=0,n=!1;for(;s<o&&!1===n;)1===t.get(r,s)?n=!0:s++;for(let o=0;o<r;o++){let n=t.get(o,s);for(let i=s;i<e;i++){let e=t.get(o,i)-n*t.get(r,i);t.set(o,i,e)}}r--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:o=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(o)||o<=0)throw new TypeError("columns must be a positive integer");let r=new D(this.rows*e,this.columns*o);for(let t=0;t<e;t++)for(let e=0;e<o;e++)r.setSubMatrix(this,this.rows*t,this.columns*e);return r}fill(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,t);return this}neg(){return this.mulS(-1)}getRow(t){b(this,t);let e=[];for(let o=0;o<this.columns;o++)e.push(this.get(t,o));return e}getRowVector(t){return D.rowVector(this.getRow(t))}setRow(t,e){b(this,t),e=M(this,e);for(let o=0;o<this.columns;o++)this.set(t,o,e[o]);return this}swapRows(t,e){b(this,t),b(this,e);for(let o=0;o<this.columns;o++){let r=this.get(t,o);this.set(t,o,this.get(e,o)),this.set(e,o,r)}return this}getColumn(t){A(this,t);let e=[];for(let o=0;o<this.rows;o++)e.push(this.get(o,t));return e}getColumnVector(t){return D.columnVector(this.getColumn(t))}setColumn(t,e){A(this,t),e=x(this,e);for(let o=0;o<this.rows;o++)this.set(o,t,e[o]);return this}swapColumns(t,e){A(this,t),A(this,e);for(let o=0;o<this.rows;o++){let r=this.get(o,t);this.set(o,t,this.get(o,e)),this.set(o,e,r)}return this}addRowVector(t){t=M(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)+t[o]);return this}subRowVector(t){t=M(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)-t[o]);return this}mulRowVector(t){t=M(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)*t[o]);return this}divRowVector(t){t=M(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)/t[o]);return this}addColumnVector(t){t=x(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)+t[e]);return this}subColumnVector(t){t=x(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)-t[e]);return this}mulColumnVector(t){t=x(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)*t[e]);return this}divColumnVector(t){t=x(this,t);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)/t[e]);return this}mulRow(t,e){b(this,t);for(let o=0;o<this.columns;o++)this.set(t,o,this.get(t,o)*e);return this}mulColumn(t,e){A(this,t);for(let o=0;o<this.rows;o++)this.set(o,t,this.get(o,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.get(e,o)>t&&(t=this.get(e,o));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.get(o,r)>t&&(t=this.get(o,r),e[0]=o,e[1]=r);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.get(e,o)<t&&(t=this.get(e,o));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.get(o,r)<t&&(t=this.get(o,r),e[0]=o,e[1]=r);return e}maxRow(t){b(this,t);let e=this.get(t,0);for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o));return e}maxRowIndex(t){b(this,t);let e=this.get(t,0),o=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r),o[1]=r);return o}minRow(t){b(this,t);let e=this.get(t,0);for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o));return e}minRowIndex(t){b(this,t);let e=this.get(t,0),o=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r),o[1]=r);return o}maxColumn(t){A(this,t);let e=this.get(0,t);for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t));return e}maxColumnIndex(t){A(this,t);let e=this.get(0,t),o=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t),o[0]=r);return o}minColumn(t){A(this,t);let e=this.get(0,t);for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t));return e}minColumnIndex(t){A(this,t);let e=this.get(0,t),o=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t),o[0]=r);return o}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let o=0;o<t;o++)e.push(this.get(o,o));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)e+=this.get(t,o)*this.get(t,o);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)t+=this.get(e,o),this.set(e,o,t);return this}dot(t){T.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let o=0;for(let r=0;r<e.length;r++)o+=e[r]*t[r];return o}mmul(t){t=D.checkMatrix(t);let e=this.rows,o=this.columns,r=t.columns,s=new D(e,r),n=new Float64Array(o);for(let i=0;i<r;i++){for(let e=0;e<o;e++)n[e]=t.get(e,i);for(let t=0;t<e;t++){let e=0;for(let r=0;r<o;r++)e+=this.get(t,r)*n[r];s.set(t,i,e)}}return s}strassen2x2(t){t=D.checkMatrix(t);let e=new D(2,2);const o=this.get(0,0),r=t.get(0,0),s=this.get(0,1),n=t.get(0,1),i=this.get(1,0),l=t.get(1,0),h=this.get(1,1),u=t.get(1,1),c=(o+h)*(r+u),a=(i+h)*r,f=o*(n-u),m=h*(l-r),g=(o+s)*u,w=c+m-g+(s-h)*(l+u),p=f+g,d=a+m,y=c-a+f+(i-o)*(r+n);return e.set(0,0,w),e.set(0,1,p),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=D.checkMatrix(t);let e=new D(3,3);const o=this.get(0,0),r=this.get(0,1),s=this.get(0,2),n=this.get(1,0),i=this.get(1,1),l=this.get(1,2),h=this.get(2,0),u=this.get(2,1),c=this.get(2,2),a=t.get(0,0),f=t.get(0,1),m=t.get(0,2),g=t.get(1,0),w=t.get(1,1),p=t.get(1,2),d=t.get(2,0),y=t.get(2,1),b=t.get(2,2),A=(o-n)*(-f+w),M=(-o+n+i)*(a-f+w),x=(n+i)*(-a+f),C=o*a,E=(-o+h+u)*(a-m+p),S=(-o+h)*(m-p),R=(h+u)*(-a+m),v=(-s+u+c)*(w+d-y),I=(s-c)*(w-y),T=s*d,N=(u+c)*(-d+y),H=(-s+i+l)*(p+d-b),L=(s-l)*(p-b),k=(i+l)*(-d+b),O=C+T+r*g,B=(o+r+s-n-i-u-c)*w+M+x+C+v+T+N,$=C+E+R+(o+r+s-i-l-h-u)*p+T+H+k,F=A+i*(-a+f+g-w-p-d+b)+M+C+T+H+L,j=A+M+x+C+l*y,z=T+H+L+k+n*m,P=C+E+S+u*(-a+m+g-w-p-d+y)+v+I+T,q=v+I+T+N+h*f,V=C+E+S+R+c*b;return e.set(0,0,O),e.set(0,1,B),e.set(0,2,$),e.set(1,0,F),e.set(1,1,j),e.set(1,2,z),e.set(2,0,P),e.set(2,1,q),e.set(2,2,V),e}mmulStrassen(t){t=D.checkMatrix(t);let e=this.clone(),o=e.rows,r=e.columns,s=t.rows,n=t.columns;function i(t,e,o){let r=t.rows,s=t.columns;if(r===e&&s===o)return t;{let r=T.zeros(e,o);return r=r.setSubMatrix(t,0,0),r}}r!==s&&console.warn(`Multiplying ${o} x ${r} and ${s} x ${n} matrix: dimensions do not match.`);let l=Math.max(o,s),h=Math.max(r,n);return e=i(e,l,h),function t(e,o,r,s){if(r<=512||s<=512)return e.mmul(o);r%2==1&&s%2==1?(e=i(e,r+1,s+1),o=i(o,r+1,s+1)):r%2==1?(e=i(e,r+1,s),o=i(o,r+1,s)):s%2==1&&(e=i(e,r,s+1),o=i(o,r,s+1));let n=parseInt(e.rows/2,10),l=parseInt(e.columns/2,10),h=e.subMatrix(0,n-1,0,l-1),u=o.subMatrix(0,n-1,0,l-1),c=e.subMatrix(0,n-1,l,e.columns-1),a=o.subMatrix(0,n-1,l,o.columns-1),f=e.subMatrix(n,e.rows-1,0,l-1),m=o.subMatrix(n,o.rows-1,0,l-1),g=e.subMatrix(n,e.rows-1,l,e.columns-1),w=o.subMatrix(n,o.rows-1,l,o.columns-1),p=t(T.add(h,g),T.add(u,w),n,l),d=t(T.add(f,g),u,n,l),y=t(h,T.sub(a,w),n,l),b=t(g,T.sub(m,u),n,l),A=t(T.add(h,c),w,n,l),M=t(T.sub(f,h),T.add(u,a),n,l),x=t(T.sub(c,g),T.add(m,w),n,l),C=T.add(p,b);C.sub(A),C.add(x);let E=T.add(y,A),S=T.add(d,b),R=T.sub(p,d);R.add(y),R.add(M);let v=T.zeros(2*C.rows,2*C.columns);return v=v.setSubMatrix(C,0,0),v=v.setSubMatrix(E,C.rows,0),v=v.setSubMatrix(S,0,C.columns),v=v.setSubMatrix(R,C.rows,C.columns),v.subMatrix(0,r-1,0,s-1)}(e,t=i(t,l,h),l,h)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:o=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(o))throw new TypeError("max must be a number");if(e>=o)throw new RangeError("min must be smaller than max");let r=new D(this.rows,this.columns);for(let t=0;t<this.rows;t++){const s=this.getRow(t);y(s,{min:e,max:o,output:s}),r.setRow(t,s)}return r}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:o=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(o))throw new TypeError("max must be a number");if(e>=o)throw new RangeError("min must be smaller than max");let r=new D(this.rows,this.columns);for(let t=0;t<this.columns;t++){const s=this.getColumn(t);y(s,{min:e,max:o,output:s}),r.setColumn(t,s)}return r}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let o=0;o<t;o++){let t=this.get(e,o),r=this.get(e,this.columns-1-o);this.set(e,o,r),this.set(e,this.columns-1-o,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let o=0;o<t;o++){let t=this.get(o,e),r=this.get(this.rows-1-o,e);this.set(o,e,r),this.set(this.rows-1-o,e,t)}return this}kroneckerProduct(t){t=D.checkMatrix(t);let e=this.rows,o=this.columns,r=t.rows,s=t.columns,n=new D(e*r,o*s);for(let i=0;i<e;i++)for(let e=0;e<o;e++)for(let o=0;o<r;o++)for(let l=0;l<s;l++)n.set(r*i+o,s*e+l,this.get(i,e)*t.get(o,l));return n}transpose(){let t=new D(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)t.set(o,e,this.get(e,o));return t}sortRows(t=N){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=N){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,o,r){S(this,t,e,o,r);let s=new D(e-t+1,r-o+1);for(let n=t;n<=e;n++)for(let e=o;e<=r;e++)s.set(n-t,e-o,this.get(n,e));return s}subMatrixRow(t,e,o){if(void 0===e&&(e=0),void 0===o&&(o=this.columns-1),e>o||e<0||e>=this.columns||o<0||o>=this.columns)throw new RangeError("Argument out of range");let r=new D(t.length,o-e+1);for(let s=0;s<t.length;s++)for(let n=e;n<=o;n++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);r.set(s,n-e,this.get(t[s],n))}return r}subMatrixColumn(t,e,o){if(void 0===e&&(e=0),void 0===o&&(o=this.rows-1),e>o||e<0||e>=this.rows||o<0||o>=this.rows)throw new RangeError("Argument out of range");let r=new D(o-e+1,t.length);for(let s=0;s<t.length;s++)for(let n=e;n<=o;n++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);r.set(n-e,s,this.get(n,t[s]))}return r}setSubMatrix(t,e,o){S(this,e,e+(t=D.checkMatrix(t)).rows-1,o,o+t.columns-1);for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)this.set(e+r,o+s,t.get(r,s));return this}selection(t,e){let o=function(t,e,o){return{row:C(t,e),column:E(t,o)}}(this,t,e),r=new D(t.length,e.length);for(let t=0;t<o.row.length;t++){let e=o.row[t];for(let s=0;s<o.column.length;s++){let n=o.column[s];r.set(t,s,this.get(e,n))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let o=0;o<t;o++)e+=this.get(o,o);return e}clone(){let t=new D(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)t.set(e,o,this.get(e,o));return t}sum(t){switch(t){case"row":return function(t){let e=R(t.rows);for(let o=0;o<t.rows;++o)for(let r=0;r<t.columns;++r)e[o]+=t.get(o,r);return e}(this);case"column":return function(t){let e=R(t.columns);for(let o=0;o<t.rows;++o)for(let r=0;r<t.columns;++r)e[r]+=t.get(o,r);return e}(this);case void 0:return function(t){let e=0;for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)e+=t.get(o,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=R(t.rows,1);for(let o=0;o<t.rows;++o)for(let r=0;r<t.columns;++r)e[o]*=t.get(o,r);return e}(this);case"column":return function(t){let e=R(t.columns,1);for(let o=0;o<t.rows;++o)for(let r=0;r<t.columns;++r)e[r]*=t.get(o,r);return e}(this);case void 0:return function(t){let e=1;for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)e*=t.get(o,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:o=!0,mean:r=this.mean(t)}=e;if("boolean"!=typeof o)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(r))throw new TypeError("mean must be an array");return function(t,e,o){const r=t.rows,s=t.columns,n=[];for(let i=0;i<r;i++){let r=0,l=0,h=0;for(let e=0;e<s;e++)h=t.get(i,e)-o[i],r+=h,l+=h*h;e?n.push((l-r*r/s)/(s-1)):n.push((l-r*r/s)/s)}return n}(this,o,r);case"column":if(!Array.isArray(r))throw new TypeError("mean must be an array");return function(t,e,o){const r=t.rows,s=t.columns,n=[];for(let i=0;i<s;i++){let s=0,l=0,h=0;for(let e=0;e<r;e++)h=t.get(e,i)-o[i],s+=h,l+=h*h;e?n.push((l-s*s/r)/(r-1)):n.push((l-s*s/r)/r)}return n}(this,o,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(t,e,o){const r=t.rows,s=t.columns,n=r*s;let i=0,l=0,h=0;for(let e=0;e<r;e++)for(let r=0;r<s;r++)h=t.get(e,r)-o,i+=h,l+=h*h;return e?(l-i*i/n)/(n-1):(l-i*i/n)/n}(this,o,r);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const o=this.variance(t,e);if(void 0===t)return Math.sqrt(o);for(let t=0;t<o.length;t++)o[t]=Math.sqrt(o[t]);return o}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:o=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(o))throw new TypeError("center must be an array");return function(t,e){for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)t.set(o,r,t.get(o,r)-e[o])}(this,o),this;case"column":if(!Array.isArray(o))throw new TypeError("center must be an array");return function(t,e){for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)t.set(o,r,t.get(o,r)-e[r])}(this,o),this;case void 0:if("number"!=typeof o)throw new TypeError("center must be a number");return function(t,e){for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)t.set(o,r,t.get(o,r)-e)}(this,o),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let o=e.scale;switch(t){case"row":if(void 0===o)o=function(t){const e=[];for(let o=0;o<t.rows;o++){let r=0;for(let e=0;e<t.columns;e++)r+=Math.pow(t.get(o,e),2)/(t.columns-1);e.push(Math.sqrt(r))}return e}(this);else if(!Array.isArray(o))throw new TypeError("scale must be an array");return function(t,e){for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)t.set(o,r,t.get(o,r)/e[o])}(this,o),this;case"column":if(void 0===o)o=function(t){const e=[];for(let o=0;o<t.columns;o++){let r=0;for(let e=0;e<t.rows;e++)r+=Math.pow(t.get(e,o),2)/(t.rows-1);e.push(Math.sqrt(r))}return e}(this);else if(!Array.isArray(o))throw new TypeError("scale must be an array");return function(t,e){for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)t.set(o,r,t.get(o,r)/e[r])}(this,o),this;case void 0:if(void 0===o)o=function(t){const e=t.size-1;let o=0;for(let r=0;r<t.columns;r++)for(let s=0;s<t.rows;s++)o+=Math.pow(t.get(s,r),2)/e;return Math.sqrt(o)}(this);else if("number"!=typeof o)throw new TypeError("scale must be a number");return function(t,e){for(let o=0;o<t.rows;o++)for(let r=0;r<t.columns;r++)t.set(o,r,t.get(o,r)/e)}(this,o),this;default:throw new Error(`invalid option: ${t}`)}}}function N(t,e){return t-e}T.prototype.klass="Matrix","undefined"!=typeof Symbol&&(T.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){const t=" ".repeat(2),e=" ".repeat(4);return`${this.constructor.name} {\n${t}[\n${e}${function(t,e){const{rows:o,columns:r}=t,s=Math.min(o,15),n=Math.min(r,10),i=[];for(let e=0;e<s;e++){let o=[];for(let r=0;r<n;r++)o.push(I(t.get(e,r)));i.push(`${o.join(" ")}`)}n!==r&&(i[i.length-1]+=` ... ${r-10} more columns`);s!==o&&i.push(`... ${o-15} more rows`);return i.join(`\n${e}`)}(this,e)}\n${t}]\n${t}rows: ${this.rows}\n${t}columns: ${this.columns}\n}`}),T.random=T.rand,T.randomInt=T.randInt,T.diagonal=T.diag,T.prototype.diagonal=T.prototype.diag,T.identity=T.eye,T.prototype.negate=T.prototype.neg,T.prototype.tensorProduct=T.prototype.kroneckerProduct;class D extends T{constructor(t,e){if(super(),D.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let o=0;o<t;o++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const o=t;if(t=o.length,"number"!=typeof(e=o[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<t;r++){if(o[r].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(o[r]))}}}return this.rows=t,this.columns=e,this}set(t,e,o){return this.data[t][e]=o,this}get(t,e){return this.data[t][e]}removeRow(t){if(b(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),b(this,t,!0),e=Float64Array.from(M(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(A(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const o=new Float64Array(this.columns-1);for(let r=0;r<t;r++)o[r]=this.data[e][r];for(let r=t+1;r<this.columns;r++)o[r-1]=this.data[e][r];this.data[e]=o}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),A(this,t,!0),e=x(this,e);for(let o=0;o<this.rows;o++){const r=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)r[s]=this.data[o][s];for(r[s++]=e[o];s<this.columns+1;s++)r[s]=this.data[o][s-1];this.data[o]=r}return this.columns+=1,this}}function H(t,e={}){const r=o();t.ensureHelperArrays(r.Molecule.cHelperNeighbours);let s=t.getAllAtoms(),n=new Array(s).fill();if(n=n.map(()=>new Array(s).fill(0)),!e.pathLength)if(e.atomicNo)for(let e=0;e<s;e++)n[e][e]=t.getAtomicNo(e);else if(e.mass)for(let e=0;e<s;e++)n[e][e]=r.Molecule.cRoundedMass[t.getAtomicNo(e)];else for(let t=0;t<s;t++)n[t][t]=1;if(e.sdt)for(let e=0;e<s;e++){let o=t.getAllConnAtoms(e);for(let r=0;r<o;r++)n[e][t.getConnAtom(e,r)]=t.getConnBondOrder(e,r)}else for(let e=0;e<s;e++){let o=t.getAllConnAtoms(e);for(let r=0;r<o;r++)n[e][t.getConnAtom(e,r)]=1}return e.pathLength&&(n=function(t){if(D.isMatrix(t)&&t.columns!==t.rows)throw new TypeError("The adjacency matrix should be squared");const e=t.columns;let o=new D(e,e);o.apply((e,r)=>{if(e===r)o.set(e,r,0);else{let s=t.get(e,r);s?o.set(e,r,s):o.set(e,r,Number.POSITIVE_INFINITY)}});for(let t=0;t<e;++t)for(let r=0;r<e;++r)for(let s=0;s<e;++s){let e=o.get(r,t)+o.get(t,s);o.get(r,s)>e&&o.set(r,s,e)}return o.apply((t,e)=>{o.get(t,e)===Number.POSITIVE_INFINITY&&o.set(t,e,-1)}),o}(new D(n)).to2DArray()),n}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)+t.get(e,o));return this},t.add=function(t,o){return new e(t).add(o)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)-t.get(e,o));return this},t.sub=function(t,o){return new e(t).sub(o)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)*t.get(e,o));return this},t.mul=function(t,o){return new e(t).mul(o)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)/t.get(e,o));return this},t.div=function(t,o){return new e(t).div(o)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)%t.get(e,o));return this},t.mod=function(t,o){return new e(t).mod(o)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)&t.get(e,o));return this},t.and=function(t,o){return new e(t).and(o)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)|t.get(e,o));return this},t.or=function(t,o){return new e(t).or(o)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)^t.get(e,o));return this},t.xor=function(t,o){return new e(t).xor(o)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)<<t.get(e,o));return this},t.leftShift=function(t,o){return new e(t).leftShift(o)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)>>t.get(e,o));return this},t.signPropagatingRightShift=function(t,o){return new e(t).signPropagatingRightShift(o)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,this.get(e,o)>>>t.get(e,o));return this},t.rightShift=function(t,o){return new e(t).rightShift(o)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,o){return new e(t).pow(o)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,Math.pow(this.get(e,o),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let o=0;o<this.columns;o++)this.set(e,o,Math.pow(this.get(e,o),t.get(e,o)));return this}}(T,D);var L=function(t,e){return t===e?0:"C"===t?-1:"C"===e?1:"H"===t?-1:"H"===e?1:t<e?-1:1};function k(t){let e=0,o={};for(let r of t){let t=r.label;e+=r.charge,r.mass&&(t=`[${r.mass}${t}]`),o[t]||(o[t]=0),o[t]+=1,r.implicitHydrogens&&(o.H||(o.H=0),o.H+=r.implicitHydrogens)}let r="",s=Object.keys(o).sort(L);for(let t of s)r+=t,o[t]>1&&(r+=o[t]);return e>0?r+=`(+${e>1?e:""})`:e<0&&(r+=`(${e<-1?e:"-"})`),r}let O,B;function $(t,e,r,n){const l=o(),h=e,u=r;let c,a=[];(t=t.getCompactCopy()).getPath(a,e,r,n+1),4===a.length&&(c=t.calculateTorsion(a));const f=s(t,e),m=s(t,r);t.addImplicitHydrogens(),t.addMissingChirality(),t.ensureHelperArrays(l.Molecule.cHelperNeighbours),e=-1,r=-1;for(let o=0;o<t.getAllAtoms();o++)f===m?t.getAtomCustomLabel(o)===f&&(-1===e?e=o:r=o):(f===t.getAtomCustomLabel(o)&&(e=o),m===t.getAtomCustomLabel(o)&&(r=o));O||(O=new l.Molecule(0,0));let g=[];t.getPath(g,e,r,n+1);let w=0,p=0,d=new Array(t.getAllAtoms()).fill(!1),y=new Array(t.getAllAtoms()).fill(-1),b=[];for(let e=0;e<=2;e++){if(0===p)for(let t of g)d[t]=!0,y[p++]=t;else{let e=p;for(let o=w;o<p;o++){let r=y[o];for(let o=0;o<t.getAllConnAtoms(r);o++){let s=t.getConnAtom(r,o);d[s]||(d[s]=!0,y[e++]=s)}}w=p,p=e}let o=[];t.copyMoleculeByAtoms(O,d,!0,o),i(O);let r=O.getCanonizedIDCode(l.Molecule.CANONIZER_ENCODE_ATOM_CUSTOM_LABELS);b.push({sphere:e,oclID:r})}return{atoms:a,from:h,to:u,torsion:c,hoses:b,length:a.length-1}}t.FULL_HOSE_CODE=c,t.HOSE_CODE_CUT_C_SP3_SP3=2,t.addDiastereotopicMissingChirality=n,t.getAtomsInfo=m,t.getConnectivityMatrix=H,t.getDiastereotopicAtomIDs=l,t.getDiastereotopicAtomIDsAndH=h,t.getHoseCodesAndDiastereotopicIDs=function(t,e){const o=l(t).map(t=>({oclID:t}));return o.forEach((function(t){const o=f(t.oclID,e);t.hoses=[];let r=0;for(const e of o)t.hoses.push({sphere:r++,oclID:e})})),o},t.getHoseCodesForAtom=a,t.getHoseCodesFromDiastereotopicID=f,t.getMF=function(t){let e=t.getFragments(),o={},r=[],s=[];e.forEach((function(t){let e=function(t,e){let o=[];for(let r=0;r<t.getAllAtoms();r++){let s={};s.charge=t.getAtomCharge(r),s.label=t.getAtomLabel(r),s.mass=t.getAtomMass(r),s.implicitHydrogens=t.getImplicitHydrogens(r),o.push(s),e.push(s)}return k(o)}(t,s);r.push(e)}));let n={};for(let t of r)n[t]||(n[t]=0),n[t]++;r=[];for(let t of Object.keys(n).sort())n[t]>1?r.push(n[t]+t):r.push(t);return o.parts=r,o.mf=k(s),o},t.getOCL=o,t.getPathsInfo=function(t,e={}){const{fromLabel:r="H",toLabel:s="H",minLength:n=1,maxLength:i=4}=e,l=o();B||(B=new l.Molecule(0,0));let h=l.Molecule.getAtomicNoFromLabel(r),u=l.Molecule.getAtomicNoFromLabel(s),c=m(t),a=H(t,{pathLength:!0});for(let e=0;e<t.getAllAtoms();e++){c[e].paths=[];for(let o=0;o<t.getAllAtoms();o++)if(e!==o&&t.getAtomicNo(e)===h&&t.getAtomicNo(o)===u){let r=a[e][o];r>=n&&r<=i&&c[e].paths.push($(t,e,o,r,c[o].oclID))}}return c},t.getShortestPaths=function(t,e={}){const r=o(),{fromLabel:s="",toLabel:n="",maxLength:i=3}=e;let l=r.Molecule.getAtomicNoFromLabel(s),h=r.Molecule.getAtomicNoFromLabel(n);const u=t.getAllAtoms();let c=new Array(u);for(let t=0;t<u;t++)c[t]=new Array(u);for(let e=0;e<u;e++){c[e][e]=[e];for(let o=e+1;o<u;o++)if(0!==l&&t.getAtomicNo(e)!==l||0!==h&&t.getAtomicNo(o)!==h)c[e][o]=null,c[o][e]=null;else{let r=[];t.getPath(r,e,o,i),r.length?(c[e][o]=r.slice(),c[o][e]=r.reverse()):(c[e][o]=null,c[o][e]=null)}}return c},t.initOCL=function(t){if(e)throw new Error("OCL-utils was already initialized with OCL");e=t},t.isCsp3=u,t.makeRacemic=i,t.tagAtom=s,t.toDiastereotopicSVG=function(t,e={}){let{width:o=300,height:r=200,prefix:s="ocl",heavyAtomHydrogen:n=!1}=e,i=e.svg,l=[],u={};if(h(t).forEach((function(t){u[t.oclID]=t})),n){for(let e=0;e<t.getAtoms();e++)l.push([]);t.getGroupedDiastereotopicAtomIDs().forEach((function(t){u[t.oclID]&&u[t.oclID].nbHydrogens>0&&t.atoms.forEach(e=>{u[t.oclID].hydrogenOCLIDs.forEach(t=>{l[1*e].includes(t)||l[e].push(t)})})}))}else l=t.getDiastereotopicAtomIDs().map(t=>[t]);return i||(i=t.toSVG(o,r,s)),i=i.replace(/Atom:[0-9]+"/g,(function(t){let e=t.replace(/[^0-9]/g,"");return`${t} data-diaid="${l[e].join(",")}"`})),i},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=openchemlib-utils.min.js.map
